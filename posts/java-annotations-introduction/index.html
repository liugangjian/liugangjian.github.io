<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Java Annotations Introduction | Gangjian Liu</title><meta name=keywords content="java,spring"><meta name=description content="Mainly describes the difference and relationship between Java annotation, AOP and Interceptor."><meta name=author content="Gangjian Liu"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://adityatelange.in/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://liugangjian.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://liugangjian.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://liugangjian.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://liugangjian.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.1.1.min.js></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Java Annotations Introduction"><meta property="og:description" content="Mainly describes the difference and relationship between Java annotation, AOP and Interceptor."><meta property="og:type" content="article"><meta property="og:url" content="https://liugangjian.github.io/posts/java-annotations-introduction/"><meta property="og:image" content="https://liugangjian.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-18T11:30:03+00:00"><meta property="article:modified_time" content="2022-01-18T11:30:03+00:00"><meta property="og:site_name" content="Gangjian Liu"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://liugangjian.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Java Annotations Introduction"><meta name=twitter:description content="Mainly describes the difference and relationship between Java annotation, AOP and Interceptor."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://liugangjian.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Java Annotations Introduction","item":"https://liugangjian.github.io/posts/java-annotations-introduction/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Java Annotations Introduction","name":"Java Annotations Introduction","description":"Mainly describes the difference and relationship between Java annotation, AOP and Interceptor.","keywords":["java","spring"],"articleBody":"Java custom annotations are generally used with  interceptors  or  AOP . Using the custom annotations to design your own framework can make the code look very elegant.\nWhat is Annotations ?  Java annotation is an annotation mechanism, introduced by jdk5.0. Classes, methods, variables, parameters and packages in the Java language can be labeled. Unlike the Javadoc, Annotation can obtain annotation content through reflection.\n When the compiler generates class files, annotations can be embedded in bytecode. The Java virtual machine can retain the annotation content and obtain the annotation content at run time. Of course, it also supports custom Java annotations.\nJava defines a set of annotations. There are 7 in total, 3 are in Java Lang, the remaining 4 knowed as meta annotations are in Java.Lang.annotation.\nThe annotations that act on the code are:\n @Override checks whether the method is an override method. If it is found that its parent class or the referenced interface does not have this method, a compilation error will be reported. @Deprecated marks obsolete methods. If this method is used, a compilation warning will be reported. @Suppresswarnings instructs the compiler to ignore warnings declared in annotations.  Meta annotations act on other annotations are:\n @Retention identifies how the annotation is saved, whether it is only in the code, incorporated into the class file, or can be accessed through reflection at run time. @Documented marks whether these annotations are included in the user document. @Target marks which Java member this annotation should be. @Inherited marks the annotation class to which the annotation is inherited (the default annotation does not inherit from any subclasses)  Common Meta Annotations There are two kinds of meta-annotations that are more commonly used:\n  @Target Describes the range of objects modified by the annotation. The value is defined in java.lang.annotation.ElementType. Commonly used include:\n METHOD: used to describe the method PACKAGE: used to describe the package PARAMETER: used to describe method variables TYPE: used to describe a class, interface or enum type    @Retention Only it is defined as RetentionPolicy.RUNTIME can we get the annotation through reflection.\n SOURCE: Valid in source files, ignored during compilation CLASS: compiled with the source file in the class file, ignored at runtime RUNTIME: Valid at runtime    @Target(ElementType.FIELD) @Retention(RetentionPolicy.RUNTIME) public @interface MyField { String description(); int length(); } Used Annotations Example 1. Reflection to get annotations Continue to use the custom annotation @MyField above, Get annotations via reflection.\npublic class MyFieldTest { // user the custion annotataion  @MyField(description = \"username\", length = 12) private String username; @Test public void testMyField(){ // get the class Template  Class c = MyFieldTest.class; // get all fields  for(Field f : c.getDeclaredFields()){ // Determine if this field has the MyField annotation  if(f.isAnnotationPresent(MyField.class)){ MyField annotation = f.getAnnotation(MyField.class); System.out.println(\"field:[\" + f.getName() + \"], description:[\" + annotation.description() + \"], length:[\" + annotation.length() +\"]\"); } } } } 2. Annotation + interceptor = Login Verification Next, we use the springboot interceptor to implement such a function. If @LoginRequired is added to the method, the user is prompted that the interface needs to be logged in to access, otherwise, no login is required.\nFirst define a LoginRequired annotation.\n@Target(ElementType.METHOD) @Retention(RetentionPolicy.RUNTIME) public @interface LoginRequired {} Then write two simple interfaces to access sourceA, sourceB resources.\n@RestController public class IndexController { @GetMapping(\"/sourceA\") public String sourceA(){ return \"you are visiting sourceA\"; } @LoginRequired @GetMapping(\"/sourceB\") public String sourceB(){ return \"you are visiting sourceB\"; } } Implement spring’s HandlerInterceptor class to implement an interceptor for login authentication.\npublic class SourceAccessInterceptor implements HandlerInterceptor { @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { System.out.println(\"entering the interceptor\"); // get the annotation through reflection  HandlerMethod handlerMethod = (HandlerMethod)handler; LoginRequired loginRequired = handlerMethod.getMethod().getAnnotation(LoginRequired.class); if(loginRequired == null){ return true; } // Prompt user to log in  response.setContentType(\"application/json; charset=utf-8\"); response.getWriter().print(\"the source you are visiting needs logined\"); return false; } @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {} @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {} } 3. Annotation + AOP = Log Printing First import the dependencies required by the aspect.\n org.springframework.boot spring-boot-starter-aop  Then define an annotation @MyLog.\n@Target(ElementType.METHOD) @Retention(RetentionPolicy.RUNTIME) public @interface MyLog {} Define a logging aspect class.\n// Indicates that this is an aspect class @Aspect @Component public class MyLogAspect { // PointCut indicates that this is a pointcut, and @annotation indicates \t// that this pointcut cuts to an annotation  @Pointcut(\"@annotation(me.zebin.demo.annotationdemo.aoplog.MyLog)\") public void logPointCut(){}; // around notify  @Around(\"logPointCut()\") public void logAround(ProceedingJoinPoint joinPoint){ // access methodName  String methodName = joinPoint.getSignature().getName(); // access param  Object[] param = joinPoint.getArgs(); StringBuilder sb = new StringBuilder(); for(Object o : param){ sb.append(o + \"; \"); } System.out.println(\"enter [\" + methodName + \"] method, parameters are:\" + sb.toString()); // continue proceed method  try { joinPoint.proceed(); } catch (Throwable throwable) { throwable.printStackTrace(); } System.out.println(methodName + \"method done\"); } } The IndexController in the second example writes a sourceC for testing, plus our custom annotations:\n@MyLog @GetMapping(\"/sourceC/{source_name}\") public String sourceC(@PathVariable(\"source_name\") String sourceName){ return \"you are visiting sourceC\"; } ","wordCount":"826","inLanguage":"en","datePublished":"2022-01-18T11:30:03Z","dateModified":"2022-01-18T11:30:03Z","author":{"@type":"Person","name":"Gangjian Liu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://liugangjian.github.io/posts/java-annotations-introduction/"},"publisher":{"@type":"Organization","name":"Gangjian Liu","logo":{"@type":"ImageObject","url":"https://adityatelange.in/assets/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://liugangjian.github.io/ accesskey=h title="‹ Home › (Alt + H)">‹ Home ›</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://liugangjian.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://liugangjian.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://liugangjian.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://liugangjian.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://liugangjian.github.io/posts/>Posts</a></div><h1 class=post-title>Java Annotations Introduction</h1><div class=post-description>Mainly describes the difference and relationship between Java annotation, AOP and Interceptor.</div><div class=post-meta><span title="2022-01-18 11:30:03 +0000 UTC">January 18, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Gangjian Liu&nbsp;|&nbsp;<a href=mailto:%20liugangjian@pku.edu.cn rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-is-annotations- aria-label="What is Annotations ?">What is Annotations ?</a></li><li><a href=#common-meta-annotations aria-label="Common Meta Annotations">Common Meta Annotations</a></li><li><a href=#used-annotations-example aria-label="Used Annotations Example">Used Annotations Example</a><ul><li><a href=#1-reflection-to-get-annotations aria-label="1. Reflection to get annotations">1. Reflection to get annotations</a></li><li><a href=#2-annotation--interceptor--login-verification aria-label="2. Annotation + interceptor = Login Verification">2. Annotation + interceptor = Login Verification</a></li><li><a href=#3-annotation--aop--log-printing aria-label="3. Annotation + AOP = Log Printing">3. Annotation + AOP = Log Printing</a></li></ul></li></ul></div></details></div><div class=post-content><p>Java custom annotations are generally used with <mark> interceptors </mark> or
<mark> AOP </mark>. Using the custom annotations to design your own framework can make the code look very elegant.</p><h2 id=what-is-annotations->What is Annotations ?<a hidden class=anchor aria-hidden=true href=#what-is-annotations->#</a></h2><blockquote><p>Java annotation is an annotation mechanism, introduced by jdk5.0.
Classes, methods, variables, parameters and packages in the Java language can be labeled.
Unlike the Javadoc, <strong>Annotation</strong> can obtain annotation content through reflection.</p></blockquote><p>When the compiler generates class files, annotations can be embedded in bytecode.
The Java virtual machine can retain the annotation content and obtain the annotation content at run time.
Of course, it also supports custom Java annotations.</p><p>Java defines a set of annotations.
There are 7 in total, 3 are in Java Lang, the remaining 4 knowed as <strong>meta annotations</strong> are in <em>Java.Lang.annotation</em>.</p><p><img loading=lazy src=https://www.runoob.com/wp-content/uploads/2019/08/28123151-d471f82eb2bc4812b46cc5ff3e9e6b82.jpg alt></p><p>The annotations that act <strong>on the code</strong> are:</p><ul><li><code>@Override</code>
checks whether the method is an override method. If it is found that its parent class or
the referenced interface does not have this method, a compilation error will be reported.</li><li><code>@Deprecated</code>
marks obsolete methods. If this method is used, a compilation warning will be reported.</li><li><code>@Suppresswarnings</code>
instructs the compiler to ignore warnings declared in annotations.</li></ul><p>Meta annotations act <strong>on other annotations</strong> are:</p><ul><li><code>@Retention</code>
identifies how the annotation is saved, whether it is only in the code, incorporated into the class file, or can be accessed through reflection at run time.</li><li><code>@Documented</code>
marks whether these annotations are included in the user document.</li><li><code>@Target</code>
marks which Java member this annotation should be.</li><li><code>@Inherited</code>
marks the annotation class to which the annotation is inherited (the default annotation does not inherit from any subclasses)</li></ul><h2 id=common-meta-annotations>Common Meta Annotations<a hidden class=anchor aria-hidden=true href=#common-meta-annotations>#</a></h2><p>There are two kinds of meta-annotations that are more commonly used:</p><ul><li><p><code>@Target</code>
Describes the range of objects modified by the annotation. The value is defined in <em>java.lang.annotation.ElementType</em>.
Commonly used include:</p><ul><li>METHOD: used to describe the method</li><li>PACKAGE: used to describe the package</li><li>PARAMETER: used to describe method variables</li><li>TYPE: used to describe a class, interface or enum type</li></ul></li><li><p><code>@Retention</code>
Only it is defined as <strong>RetentionPolicy.RUNTIME</strong> can we get the annotation through reflection.</p><ul><li>SOURCE: Valid in source files, ignored during compilation</li><li>CLASS: compiled with the source file in the class file, ignored at runtime</li><li>RUNTIME: Valid at runtime</li></ul></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Target</span><span style=color:#f92672>(</span>ElementType<span style=color:#f92672>.</span><span style=color:#a6e22e>FIELD</span><span style=color:#f92672>)</span>
<span style=color:#a6e22e>@Retention</span><span style=color:#f92672>(</span>RetentionPolicy<span style=color:#f92672>.</span><span style=color:#a6e22e>RUNTIME</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>@interface</span> MyField <span style=color:#f92672>{</span>
    String <span style=color:#a6e22e>description</span><span style=color:#f92672>();</span>
    <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>length</span><span style=color:#f92672>();</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=used-annotations-example>Used Annotations Example<a hidden class=anchor aria-hidden=true href=#used-annotations-example>#</a></h2><h3 id=1-reflection-to-get-annotations>1. Reflection to get annotations<a hidden class=anchor aria-hidden=true href=#1-reflection-to-get-annotations>#</a></h3><p>Continue to use the custom annotation <code>@MyField</code> above, Get annotations via reflection.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyFieldTest</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e>// user the custion annotataion
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>@MyField</span><span style=color:#f92672>(</span>description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>,</span> length <span style=color:#f92672>=</span> 12<span style=color:#f92672>)</span>
    <span style=color:#66d9ef>private</span> String username<span style=color:#f92672>;</span>
    <span style=color:#a6e22e>@Test</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMyField</span><span style=color:#f92672>(){</span>
        <span style=color:#75715e>// get the class Template
</span><span style=color:#75715e></span>        Class c <span style=color:#f92672>=</span> MyFieldTest<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>;</span>
        <span style=color:#75715e>// get all fields
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>for</span><span style=color:#f92672>(</span>Field f <span style=color:#f92672>:</span> c<span style=color:#f92672>.</span><span style=color:#a6e22e>getDeclaredFields</span><span style=color:#f92672>()){</span>
            <span style=color:#75715e>// Determine if this field has the MyField annotation
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>f<span style=color:#f92672>.</span><span style=color:#a6e22e>isAnnotationPresent</span><span style=color:#f92672>(</span>MyField<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)){</span>
                MyField annotation <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span><span style=color:#a6e22e>getAnnotation</span><span style=color:#f92672>(</span>MyField<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
                System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;field:[&#34;</span> <span style=color:#f92672>+</span> f<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;], description:[&#34;</span> <span style=color:#f92672>+</span> annotation<span style=color:#f92672>.</span><span style=color:#a6e22e>description</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;], length:[&#34;</span> <span style=color:#f92672>+</span> annotation<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span><span style=color:#e6db74>&#34;]&#34;</span><span style=color:#f92672>);</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=2-annotation--interceptor--login-verification>2. Annotation + interceptor = Login Verification<a hidden class=anchor aria-hidden=true href=#2-annotation--interceptor--login-verification>#</a></h3><p>Next, we use the springboot interceptor to implement such a function.
If <code>@LoginRequired</code> is added to the method, the user is prompted that the interface needs to be logged in to access,
otherwise, no login is required.</p><p>First define a LoginRequired annotation.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Target</span><span style=color:#f92672>(</span>ElementType<span style=color:#f92672>.</span><span style=color:#a6e22e>METHOD</span><span style=color:#f92672>)</span>
<span style=color:#a6e22e>@Retention</span><span style=color:#f92672>(</span>RetentionPolicy<span style=color:#f92672>.</span><span style=color:#a6e22e>RUNTIME</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>@interface</span> LoginRequired <span style=color:#f92672>{}</span>
</code></pre></div><p>Then write two simple interfaces to access sourceA, sourceB resources.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@RestController</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IndexController</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@GetMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/sourceA&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>sourceA</span><span style=color:#f92672>(){</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;you are visiting sourceA&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
	
	<span style=color:#a6e22e>@LoginRequired</span>
    <span style=color:#a6e22e>@GetMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/sourceB&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>sourceB</span><span style=color:#f92672>(){</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;you are visiting sourceB&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Implement spring&rsquo;s HandlerInterceptor class to implement an interceptor for login authentication.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SourceAccessInterceptor</span> <span style=color:#66d9ef>implements</span> HandlerInterceptor <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>preHandle</span><span style=color:#f92672>(</span>HttpServletRequest request<span style=color:#f92672>,</span> HttpServletResponse response<span style=color:#f92672>,</span> Object handler<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;entering the interceptor&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#75715e>// get the annotation through reflection
</span><span style=color:#75715e></span>        HandlerMethod handlerMethod <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HandlerMethod<span style=color:#f92672>)</span>handler<span style=color:#f92672>;</span>
        LoginRequired loginRequired <span style=color:#f92672>=</span> handlerMethod<span style=color:#f92672>.</span><span style=color:#a6e22e>getMethod</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getAnnotation</span><span style=color:#f92672>(</span>LoginRequired<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>loginRequired <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>}</span>
        <span style=color:#75715e>// Prompt user to log in
</span><span style=color:#75715e></span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setContentType</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;application/json; charset=utf-8&#34;</span><span style=color:#f92672>);</span>
        response<span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>().</span><span style=color:#a6e22e>print</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;the source you are visiting needs logined&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
	
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>postHandle</span><span style=color:#f92672>(</span>HttpServletRequest request<span style=color:#f92672>,</span> HttpServletResponse response<span style=color:#f92672>,</span> Object handler<span style=color:#f92672>,</span> ModelAndView modelAndView<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{}</span>
    
	<span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>afterCompletion</span><span style=color:#f92672>(</span>HttpServletRequest request<span style=color:#f92672>,</span> HttpServletResponse response<span style=color:#f92672>,</span> Object handler<span style=color:#f92672>,</span> Exception ex<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=3-annotation--aop--log-printing>3. Annotation + AOP = Log Printing<a hidden class=anchor aria-hidden=true href=#3-annotation--aop--log-printing>#</a></h3><p>First import the dependencies required by the aspect.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dependency&gt;</span>
	<span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-aop<span style=color:#f92672>&lt;/artifactId&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>
</code></pre></div><p>Then define an annotation <code>@MyLog</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Target</span><span style=color:#f92672>(</span>ElementType<span style=color:#f92672>.</span><span style=color:#a6e22e>METHOD</span><span style=color:#f92672>)</span>
<span style=color:#a6e22e>@Retention</span><span style=color:#f92672>(</span>RetentionPolicy<span style=color:#f92672>.</span><span style=color:#a6e22e>RUNTIME</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>@interface</span> MyLog <span style=color:#f92672>{}</span>
</code></pre></div><p>Define a logging aspect class.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Indicates that this is an aspect class
</span><span style=color:#75715e></span><span style=color:#a6e22e>@Aspect</span>
<span style=color:#a6e22e>@Component</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyLogAspect</span> <span style=color:#f92672>{</span>
	<span style=color:#75715e>// PointCut indicates that this is a pointcut, and @annotation indicates 
</span><span style=color:#75715e></span>	<span style=color:#75715e>// that this pointcut cuts to an annotation
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>@Pointcut</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;@annotation(me.zebin.demo.annotationdemo.aoplog.MyLog)&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>logPointCut</span><span style=color:#f92672>(){};</span>
    
	<span style=color:#75715e>// around notify
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>@Around</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;logPointCut()&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>logAround</span><span style=color:#f92672>(</span>ProceedingJoinPoint joinPoint<span style=color:#f92672>){</span>
        <span style=color:#75715e>// access methodName
</span><span style=color:#75715e></span>        String methodName <span style=color:#f92672>=</span> joinPoint<span style=color:#f92672>.</span><span style=color:#a6e22e>getSignature</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>();</span>
        <span style=color:#75715e>// access param
</span><span style=color:#75715e></span>        Object<span style=color:#f92672>[]</span> param <span style=color:#f92672>=</span> joinPoint<span style=color:#f92672>.</span><span style=color:#a6e22e>getArgs</span><span style=color:#f92672>();</span>
        StringBuilder sb <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StringBuilder<span style=color:#f92672>();</span>
        <span style=color:#66d9ef>for</span><span style=color:#f92672>(</span>Object o <span style=color:#f92672>:</span> param<span style=color:#f92672>){</span>
            sb<span style=color:#f92672>.</span><span style=color:#a6e22e>append</span><span style=color:#f92672>(</span>o <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;; &#34;</span><span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>
        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;enter [&#34;</span> <span style=color:#f92672>+</span> methodName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;] method, parameters are:&#34;</span> <span style=color:#f92672>+</span> sb<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
        <span style=color:#75715e>// continue proceed method
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
            joinPoint<span style=color:#f92672>.</span><span style=color:#a6e22e>proceed</span><span style=color:#f92672>();</span>
        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Throwable throwable<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            throwable<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
        <span style=color:#f92672>}</span>
        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>methodName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;method done&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>The IndexController in the second example writes a <em>sourceC</em> for testing, plus our custom annotations:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@MyLog</span>
    <span style=color:#a6e22e>@GetMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/sourceC/{source_name}&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>sourceC</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@PathVariable</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;source_name&#34;</span><span style=color:#f92672>)</span> String sourceName<span style=color:#f92672>){</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;you are visiting sourceC&#34;</span><span style=color:#f92672>;</span> 
    <span style=color:#f92672>}</span>
</code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://liugangjian.github.io/tags/java/>java</a></li><li><a href=https://liugangjian.github.io/tags/spring/>spring</a></li></ul><nav class=paginav><a class=prev href=https://liugangjian.github.io/posts/hugo-automatic-deployment/><span class=title>« Prev Page</span><br><span>Hugo Automatic deployment</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://liugangjian.github.io/>Gangjian Liu</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>